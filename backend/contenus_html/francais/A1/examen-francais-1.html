<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Examen 1 — Niveau A1 (Salutations · Jours · Famille)</title>
    <link
      rel="stylesheet"
      href="/contenus_css/francais/A1/examen-francais-1.css"
    />
  </head>
  <body>
    <!-- Barre de retour -->
    <nav class="topbar">
      <a href="http://localhost:5173/cours/francais" class="backlink"
        >← Retour aux cours</a
      >
    </nav>

    <header class="page-header">
      <h1>Examen 1 — Niveau A1</h1>
      <p class="subtitle">Les salutations · Les jours · La famille</p>
    </header>

    <!-- SCORE GLOBAL (collant en haut) -->
    <section id="score-global" class="score-wrapper" aria-live="polite">
      <div class="score-card">
        <div>
          <div class="score-title">Score total</div>
          <div class="score-subtitle">Somme pondérée : /20</div>
        </div>
        <div class="score-right">
          <span id="score-value">0 / 20</span>
          <button id="btn-recalc" class="btn">Recalculer</button>
        </div>
      </div>
    </section>

    <main class="container">
      <!-- CONSIGNES -->
      <section class="section">
        <h2>Consignes</h2>
        <ul class="intro-list">
          <li>Lisez attentivement chaque consigne.</li>
          <li>
            Écrivez vos réponses en <em>minuscules</em> (ex. :
            <code>lundi</code>, <code>grand-père</code>).
          </li>
          <li>
            Utilisez <strong>Vérifier</strong>,
            <strong>Montrer les réponses</strong> et
            <strong>Réinitialiser</strong> pour chaque partie.
          </li>
          <li>
            À la fin, cliquez sur <strong>Recalculer</strong> (carte du score)
            pour afficher votre note /20.
          </li>
        </ul>
      </section>

      <!-- PARTIE A — Salutations (QCM) [5 pts] -->
      <section class="section exam-section" id="partie-a">
        <h2>Partie A — Salutations (QCM)</h2>
        <p>Choisissez la bonne réponse.</p>

        <div class="exercise" data-section="A">
          <div class="qcm-block">
            <div class="qcm-group" data-answer="b" data-name="A1">
              <p class="q">
                1. Forme <strong>formelle</strong> pour dire bonjour
                l’après-midi :
              </p>
              <label><input type="radio" name="A1" value="a" /> Salut</label>
              <label><input type="radio" name="A1" value="b" /> Bonjour</label>
              <label><input type="radio" name="A1" value="c" /> Coucou</label>
            </div>

            <div class="qcm-group" data-answer="b" data-name="A2">
              <p class="q">
                2. Question informelle pour demander « Comment vas-tu ? » :
              </p>
              <label
                ><input type="radio" name="A2" value="a" /> Comment allez-vous
                ?</label
              >
              <label><input type="radio" name="A2" value="b" /> Ça va ?</label>
              <label><input type="radio" name="A2" value="c" /> Enchanté</label>
            </div>

            <div class="qcm-group" data-answer="a" data-name="A3">
              <p class="q">
                3. Pour une rencontre <strong>formelle</strong>, on dit :
              </p>
              <label
                ><input type="radio" name="A3" value="a" /> Enchanté(e)</label
              >
              <label><input type="radio" name="A3" value="b" /> À plus</label>
              <label><input type="radio" name="A3" value="c" /> Coucou</label>
            </div>

            <div class="qcm-group" data-answer="c" data-name="A4">
              <p class="q">4. « À bientôt » est :</p>
              <label
                ><input type="radio" name="A4" value="a" /> uniquement
                informel</label
              >
              <label
                ><input type="radio" name="A4" value="b" /> uniquement
                formel</label
              >
              <label
                ><input type="radio" name="A4" value="c" /> formel ou
                informel</label
              >
            </div>

            <div class="qcm-group" data-answer="b" data-name="A5">
              <p class="q">
                5. Dans un magasin en France, il faut d’abord dire :
              </p>
              <label><input type="radio" name="A5" value="a" /> Salut</label>
              <label><input type="radio" name="A5" value="b" /> Bonjour</label>
              <label><input type="radio" name="A5" value="c" /> Ça va ?</label>
            </div>
          </div>

          <div class="btn-row">
            <button class="btn verifier">Vérifier</button>
            <button class="btn btn-secondary montrer">
              Montrer les réponses
            </button>
            <button class="btn btn-ghost reinitialiser">Réinitialiser</button>
          </div>
          <div class="resultat" id="res-A"></div>
        </div>
      </section>

      <!-- PARTIE B — Les jours (compléter) [6 pts] -->
      <section class="section exam-section" id="partie-b">
        <h2>Partie B — Les jours de la semaine (compléter)</h2>
        <p>Complétez avec le <strong>jour correct</strong>.</p>

        <div class="exercise" data-section="B">
          <ol class="fill-list">
            <li>
              Le premier jour de la semaine est
              <input type="text" class="fill" data-answer="lundi" />.
            </li>
            <li>
              Le jour après jeudi est
              <input type="text" class="fill" data-answer="vendredi" />.
            </li>
            <li>
              Le weekend comprend
              <input type="text" class="fill" data-answer="samedi" /> et
              <input type="text" class="fill" data-answer="dimanche" />.
            </li>
            <li>
              Le jour entre mardi et jeudi est
              <input type="text" class="fill" data-answer="mercredi" />.
            </li>
            <li>
              Avant mardi, c’est
              <input type="text" class="fill" data-answer="lundi" />.
            </li>
          </ol>

          <div class="btn-row">
            <button class="btn verifier">Vérifier</button>
            <button class="btn btn-secondary montrer">
              Montrer les réponses
            </button>
            <button class="btn btn-ghost reinitialiser">Réinitialiser</button>
          </div>
          <div class="resultat" id="res-B"></div>
        </div>
      </section>

      <!-- PARTIE C — La famille (associer) [6 pts] -->
      <section class="section exam-section" id="partie-c">
        <h2>Partie C — La famille (associer)</h2>
        <p>Sélectionnez le terme familial correct.</p>

        <div class="exercise" data-section="C">
          <div class="assoc-grid">
            <div class="assoc-item">
              <span>Le père de ma mère est mon :</span>
              <select data-answer="grand-père">
                <option value="">— Choisir —</option>
                <option>grand-père</option>
                <option>oncle</option>
                <option>beau-père</option>
                <option>neveu</option>
              </select>
            </div>
            <div class="assoc-item">
              <span>La sœur de mon père est ma :</span>
              <select data-answer="tante">
                <option value="">— Choisir —</option>
                <option>grand-mère</option>
                <option>tante</option>
                <option>cousine</option>
                <option>nièce</option>
              </select>
            </div>
            <div class="assoc-item">
              <span>Le fils de mon oncle est mon :</span>
              <select data-answer="cousin">
                <option value="">— Choisir —</option>
                <option>cousin</option>
                <option>beau-frère</option>
                <option>gendre</option>
                <option>frère</option>
              </select>
            </div>
            <div class="assoc-item">
              <span>La fille de ma sœur est ma :</span>
              <select data-answer="nièce">
                <option value="">— Choisir —</option>
                <option>nièce</option>
                <option>cousine</option>
                <option>belle-sœur</option>
                <option>mère</option>
              </select>
            </div>
            <div class="assoc-item">
              <span>Le mari de ma sœur est mon :</span>
              <select data-answer="beau-frère">
                <option value="">— Choisir —</option>
                <option>beau-frère</option>
                <option>oncle</option>
                <option>père</option>
                <option>neveu</option>
              </select>
            </div>
            <div class="assoc-item">
              <span>Les parents de mon père sont mes :</span>
              <select data-answer="grands-parents">
                <option value="">— Choisir —</option>
                <option>grands-parents</option>
                <option>beaux-parents</option>
                <option>frères et sœurs</option>
                <option>enfants</option>
              </select>
            </div>
          </div>

          <div class="btn-row">
            <button class="btn verifier">Vérifier</button>
            <button class="btn btn-secondary montrer">
              Montrer les réponses
            </button>
            <button class="btn btn-ghost reinitialiser">Réinitialiser</button>
          </div>
          <div class="resultat" id="res-C"></div>
        </div>
      </section>

      <!-- PARTIE D — Production écrite [3 pts] -->
      <section class="section exam-section" id="partie-d">
        <h2>Partie D — Production écrite</h2>
        <p>
          Écrivez un court paragraphe (5–7 phrases) pour vous présenter et
          parler de votre famille. Incluez au moins <strong>6 termes</strong> du
          champ lexical de la famille (ex.:
          <em
            >père, mère, sœur, frère, grands-parents, oncle, tante, cousin(e),
            nièce, neveu, beau-frère, belle-sœur</em
          >).
        </p>

        <div class="exercise" data-section="D">
          <textarea
            id="prod"
            rows="8"
            placeholder="Écrivez votre texte ici..."
          ></textarea>

          <div class="btn-row">
            <button class="btn verifier">
              Vérifier (auto-compte des termes)
            </button>
            <button class="btn btn-ghost reinitialiser">Effacer</button>
          </div>
          <div class="resultat" id="res-D"></div>
        </div>
      </section>

      <!-- Récap (pondération) -->
      <section class="section">
        <h2>Barème</h2>
        <ul>
          <li>Partie A : 5 points</li>
          <li>Partie B : 6 points</li>
          <li>Partie C : 6 points</li>
          <li>
            Partie D : 3 points (automatique si longueur OK <em>et</em> ≥ 6
            termes familiaux)
          </li>
        </ul>
      </section>
    </main>

    <footer class="page-footer">
      <p>© 2025 — Examen Niveau A1</p>
    </footer>

    <script>
      // ===== Helpers =====
      const stripAcc = (s) =>
        (s || "").normalize("NFD").replace(/[\u0300-\u036f]/g, "");
      const norm = (s) =>
        stripAcc(String(s).trim().toLowerCase().replace(/\s+/g, " "));
      const addState = (el, state) => {
        el.classList.remove("correct", "incorrect", "empty");
        if (state) el.classList.add(state);
      };

      function percentage(score, total) {
        return total ? Math.round((score / total) * 100) : 0;
      }
      function setMsg(el, txt, good) {
        if (!el) return;
        el.textContent = txt;
        el.classList.toggle("correct", !!good);
      }

      // ===== Partie A (QCM) =====
      function verifyA(section) {
        let ok = 0,
          tot = 0;
        section.querySelectorAll(".qcm-group").forEach((group) => {
          tot++;
          const ans = group.dataset.answer;
          const name = group.dataset.name;
          const checked = group.querySelector(`input[name="${name}"]:checked`);
          if (!checked) {
            addState(group, "empty");
            return;
          }
          if (checked.value === ans) {
            ok++;
            addState(group, "correct");
          } else addState(group, "incorrect");
        });
        const res = section.querySelector("#res-A");
        setMsg(
          res,
          `Score A : ${ok}/${tot} (${percentage(ok, tot)}%)`,
          ok === tot
        );
        return ok; // /5
      }
      function showA(section) {
        section.querySelectorAll(".qcm-group").forEach((group) => {
          const ans = group.dataset.answer;
          const name = group.dataset.name;
          const inp = group.querySelector(
            `input[name="${name}"][value="${ans}"]`
          );
          if (inp) inp.checked = true;
          addState(group, "correct");
        });
        verifyA(section);
      }
      function resetA(section) {
        section
          .querySelectorAll('.qcm-group input[type="radio"]:checked')
          .forEach((i) => (i.checked = false));
        section.querySelectorAll(".qcm-group").forEach((g) => addState(g, ""));
        setMsg(section.querySelector("#res-A"), "");
      }

      // ===== Partie B (text inputs) =====
      function verifyB(section) {
        let ok = 0,
          tot = 0;
        section.querySelectorAll("input.fill[data-answer]").forEach((inp) => {
          tot++;
          const user = norm(inp.value);
          const ans = norm(inp.dataset.answer);
          if (!user) {
            addState(inp, "empty");
            return;
          }
          if (user === ans) {
            ok++;
            addState(inp, "correct");
          } else addState(inp, "incorrect");
        });
        const res = section.querySelector("#res-B");
        setMsg(
          res,
          `Score B : ${ok}/${tot} (${percentage(ok, tot)}%)`,
          ok === tot
        );
        return ok; // /6
      }
      function showB(section) {
        section.querySelectorAll("input.fill[data-answer]").forEach((inp) => {
          inp.value = inp.dataset.answer;
          addState(inp, "correct");
        });
        verifyB(section);
      }
      function resetB(section) {
        section.querySelectorAll("input.fill[data-answer]").forEach((inp) => {
          inp.value = "";
          addState(inp, "");
        });
        setMsg(section.querySelector("#res-B"), "");
      }

      // ===== Partie C (selects) =====
      function verifyC(section) {
        let ok = 0,
          tot = 0;
        section.querySelectorAll("select[data-answer]").forEach((sel) => {
          tot++;
          const user = norm(sel.value);
          const ans = norm(sel.dataset.answer);
          if (!user) {
            addState(sel, "empty");
            return;
          }
          if (user === ans) {
            ok++;
            addState(sel, "correct");
          } else addState(sel, "incorrect");
        });
        const res = section.querySelector("#res-C");
        setMsg(
          res,
          `Score C : ${ok}/${tot} (${percentage(ok, tot)}%)`,
          ok === tot
        );
        return ok; // /6
      }
      function showC(section) {
        section.querySelectorAll("select[data-answer]").forEach((sel) => {
          const ans = sel.dataset.answer;
          Array.from(sel.options).forEach((opt, i) => {
            if (norm(opt.value) === norm(ans)) sel.selectedIndex = i;
          });
          addState(sel, "correct");
        });
        verifyC(section);
      }
      function resetC(section) {
        section.querySelectorAll("select[data-answer]").forEach((sel) => {
          sel.selectedIndex = 0;
          addState(sel, "");
        });
        setMsg(section.querySelector("#res-C"), "");
      }

      // ===== Partie D (production) =====
      const TERMS_FAMILLE = [
        "père",
        "mère",
        "frère",
        "soeur",
        "sœur",
        "parents",
        "enfant",
        "fils",
        "fille",
        "grand-père",
        "grand-mère",
        "grands-parents",
        "oncle",
        "tante",
        "cousin",
        "cousine",
        "neveu",
        "nièce",
        "beau-père",
        "belle-mère",
        "beau-frère",
        "belle-soeur",
        "belle-sœur",
        "gendre",
        "belle-fille",
        "famille",
        "demi-frère",
        "demi-soeur",
        "demi-sœur",
        "jumeau",
        "jumelle",
        "aîné",
        "cadet",
      ];
      function verifyD(section) {
        const ta = section.querySelector("#prod");
        const txt = norm(ta.value);
        const words = txt.split(/\s+/).filter(Boolean);
        let count = 0;
        TERMS_FAMILLE.forEach((t) => {
          if (txt.includes(norm(t))) count++;
        });
        const longOK = words.length >= 40; // ~5–7 phrases courtes
        const termsOK = count >= 6;
        const ok = longOK && termsOK;
        const score = ok ? 3 : 0;
        const res = section.querySelector("#res-D");
        res.innerHTML = ok
          ? `✅ Longueur OK et ≥ 6 termes (trouvés : ${count}). Score D : 3/3`
          : `❌ Critères non atteints — ${
              longOK ? "" : "longueur insuffisante; "
            }${termsOK ? "" : `termes familiaux : ${count}/6`} — Score D : 0/3`;
        res.classList.toggle("correct", ok);
        return score; // 0 ou 3
      }
      function resetD(section) {
        section.querySelector("#prod").value = "";
        setMsg(section.querySelector("#res-D"), "");
      }

      // ===== Score global (/20, pondéré) =====
      function computeTotal() {
        const a = verifyA(document.querySelector("#partie-a .exercise")) || 0; // /5
        const b = verifyB(document.querySelector("#partie-b .exercise")) || 0; // /6
        const c = verifyC(document.querySelector("#partie-c .exercise")) || 0; // /6
        const d = verifyD(document.querySelector("#partie-d .exercise")) || 0; // /3
        const total = a + b + c + d; // /20
        const label = document.getElementById("score-value");
        label.textContent = `${total} / 20`;
        label.style.background =
          total === 20 ? "var(--ok-bg)" : "var(--hint-bg)";
        return total;
      }

      // ===== Wiring des boutons =====
      document.querySelectorAll(".exercise").forEach((sec) => {
        const id = sec.dataset.section;
        sec.querySelector(".verifier")?.addEventListener("click", () => {
          if (id === "A") verifyA(sec);
          if (id === "B") verifyB(sec);
          if (id === "C") verifyC(sec);
          if (id === "D") verifyD(sec);
          computeTotal();
        });
        sec.querySelector(".montrer")?.addEventListener("click", () => {
          if (id === "A") showA(sec);
          if (id === "B") showB(sec);
          if (id === "C") showC(sec);
          computeTotal();
        });
        sec.querySelector(".reinitialiser")?.addEventListener("click", () => {
          if (id === "A") resetA(sec);
          if (id === "B") resetB(sec);
          if (id === "C") resetC(sec);
          if (id === "D") resetD(sec);
          computeTotal();
        });
      });

      document
        .getElementById("btn-recalc")
        ?.addEventListener("click", computeTotal);
      document.addEventListener("change", (e) => {
        if (e.target.matches("input, select, textarea")) computeTotal();
      });
      computeTotal(); // init
    </script>
  </body>
</html>
